<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <title>กรอกข้อมูลเพื่อทำการนัดหมาย</title>
  <link rel="stylesheet" href="style.css">
  <style>
    button.loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .message {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- โลโก้ + หัวเรื่อง -->
    <div class="logo">
      <img src="/โปร่งใส.png" alt="logo icon">
      <div class="logo-text">
        <strong>กรอกรายละเอียด</strong><br><span>ข้อมูล</span>
      </div>
    </div>

    <!-- ฟอร์ม -->
    <form id="bookingForm">
      <!-- แถวชื่อเล่น/สาขา + คณะ -->
      <div class="row name-faculty-row">
        <input type="text" name="fullname" placeholder="ชื่อ-นามสกุล" required />
      </div>

      <select id="gender" name="gender">
        <option value="gender">-- เพศ --</option>
        <option value="male">ชาย</option>
        <option value="female">หญิง</option>
        <option value="other">อื่น ๆ</option>
      </select>

      <input type="tel" name="phone" placeholder="เบอร์โทร ติดต่อ" required />
      <input type="text" name="idline" placeholder="ID Line" required />
      <!-- แถวจำนวนคน + เงินมัดจำ -->
      <div class="row">
        <div class="field">
          <input type="number" name="people" placeholder="จำนวนคนผู้เข้าพัก" min="1" required />
        </div>
      </div>

      <input type="text" name="nationality" placeholder="สัญชาติ" required />
      <input type="text" name="occupation" placeholder="อาชีพ/สถาศึกษา" required />
      <input type="text" name="other" placeholder="รายละเอียดเพิ่มเติม" required />

      <div class="field">
        <div class="choice-group">
          <span class="title">ยานพาหนะ (รถยนต์)</span><br>

          <label class="radio-box">
            <input type="radio" name="has_car" value="yes">
            <span class="custom-radio"></span>มี
          </label>

          <label class="radio-box">
            <input type="radio" name="has_car" value="no">
            <span class="custom-radio"></span>ไม่มี
          </label>
        </div>
        <br>
        <br>
        <div class="field">
          <div class="choice-group">
            <span class="title">สัตว์เลี้ยง </span><br>

            <label class="radio-box">
              <input type="radio" name="has_pet" value="yes">
              <span class="custom-radio"></span>มี
            </label>

            <label class="radio-box">
              <input type="radio" name="has_pet" value="no">
              <span class="custom-radio"></span>ไม่มี
            </label>
          </div>
          <br>

          <div class="budget-box">
            <label for="budget">งบประมาณ(บาท)</label> 

            <div class="range-value">
              <span id="budgetValue">3000</span> บาท
              <br>
              <label for="budet">ต่ำ</label>
              <label for="budet">สูง</label>
            </div>

            <input type="range" id="budget" name="budget" min="6000" max="15000" step="500" value="6000">
          </div>

          <!-- แถววันที่และเวลา -->
           <h3>เวลาที่ต้องการนัดหมาย</h3>
          <div class="row">
            <div class="field">
              <label>วันที่</label>
              <input type="date" name="date" required />
            </div>
            <div class="field">
              <label>เวลา</label>
              <input type="time" name="timeStart" required />
            </div>
          </div>
          <br>
          <button type="submit">ส่ง</button>
    </form>

    <div id="message" class="message"></div>
  </div>

  <script>
    // งบประมาณเเบบสไลด์ปุ่มเดี่ยว
    const slider = document.getElementById("budget");
    const output = document.getElementById("budgetValue");

    function updateBudget() {
      output.textContent = slider.value;
    }

    slider.addEventListener("input", updateBudget);
    updateBudget();

    // ตั้งค่าขั้นต่ำวันที่เป็นวันนี้
    const today = new Date().toISOString().split("T")[0];
    document.querySelector('input[type="date"]').setAttribute("min", today);

    // ส่งฟอร์มแบบ async

    const scriptURL = "https://script.google.com/macros/s/AKfycbwj36RrWHkMc_EMTgcYMM-SF32-Y2j-G6UvsMhe47Z5s-UU3aitAh0IL8NgnABrZBrd/exec";

    document.getElementById("bookingForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const form = e.target;
      const message = document.getElementById("message");
      const button = form.querySelector("button");

      button.classList.add("loading");
      message.textContent = "กำลังส่งข้อมูล...";

      const formData = Object.fromEntries(new FormData(form).entries());

      try {
        const res = await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(formData),
          mode: "no-cors"   // ⭐ จุดสำคัญ แก้ error ได้แน่นอน
        });

        // ถ้าส่งถึง Apps Script แล้ว ให้ถือว่าสำเร็จทันที
        message.textContent = "ส่งข้อมูลสำเร็จ ✅ "; 
        form.reset();

      } catch (err) {
        message.textContent = "เชื่อมต่อไม่สำเร็จ ❌";
        console.error(err);
      }

      button.classList.remove("loading");
    });

  </script>

</body>

</html>